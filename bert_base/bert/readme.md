# 分词后：
tokens: [CLS] 这 种 图 片 是 用 什 么 软 件 制 作 的 ？ [SEP] 这 种 图 片 制 作 是 用 什 么 软 件 呢 ？ [SEP]

[CLS]是模型额外增加的开始标志，说明这是句首位置。
[SEP]代表分隔符，我们会将两句话拼接成一句话，通过分隔符来识别。
第二句话拼接完成后也会加上一个分隔符。
这里需要注意的是BERT对于中文分词是以每个字进行切分，并不是我们通常理解的按照中文实际的词进行切分。

经过特征提取之后变成了：

input_ids：101 6821 4905 1745 4275 3221 4500 784 720 6763 816 1169 868 46388043 102 6821 4905 1745 4275 1169 868 3221 4500 784 720 6763 816 1450 8043 1020 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 00 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 00 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

input_mask：1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 00 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 00 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 00 0 0 0 0 0 0 0 0 0 0 0 0 0

segment_ids：0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 00 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 00 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 00 0 0 0 0 0 0 0 0 0 0 0 0 0

label_id：1

# 这里详细说下我们真正给模型输入的特征是什么。
[CLS]...[SEP] 为第一句；   ...[SEP] 为第二句
input_ids 代表词向量编码。
    NLP任务中我们会将文本转化成词向量的表征形式提供给模型。通过BERT源码中的tokenizer将句子拆分成字，并且将字映射成id。比如上面例子中第一句话有14个字，第二句话也有14个字，再加上一个开始标志和两个分隔符，一种有31个字。而上面例子中的input_ids列表中前31个位置都有每个字映射的id，并且相同字的映射的id也是一样的。其他则通过添加0进行填充；

input_mask代表位置编码。为了transformer感知词与词之间的位置关系，源码中会将当前位置有字的设置为1，其他用0进行填充；

segment_ids代表句子关系编码。如果是句子关系判断任务则会将text_b位置对应的句子关系编码置为1。这里需要注意，只要是句子关系判断任务，不管两句话到底有没有关系，即标签是否为1都会将text_b位置对应的句子关系编码置为1；

label_id就代表两句话是不是有关系。如果有关系则标签置为1，否则为0。



3.2 特征存储在TFRecord格式文件
当我们进行模型训练的时候，会将全部训练数据加载到内存中。对于小规模数据集来说没有问题，但是遇到大规模数据集时我们的内存并不能加载全部的数据，所以涉及到分批加载数据。Tensorflow给开发者提供了TFRecord格式文件。TFRecord内部采用二进制编码，加载快，对大型数据转换友好。

小结下，特征处理模块主要将预处理得到的数据转化成特征并存储到TFRecord格式文件。BERT会将句子输入转化成三层Embedding编码，第一层是词编码，主要表示词本身；第二层编码是位置编码，主要为了transformer感知词与词之间的位置关系；第三层编码则表示句与句之间关系。通过这三层编码我们就得到了模型的特征输入。为了方便大数据集下模型训练加载数据，我们将特征持久化到TFRecord格式文件。

4.2 模型标准输入
因为源项目是基于Tensorflow框架开发，所以需要将前面得到的特征转化成标准的Tensorflow模型输入格式。这块主要由函数file_based_input_fn_builder来完成。通过输入文件的不同可以完成训练集、验证集和测试集的输入。